!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.D3HarChart=f()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";function arrayToDomainRegex(domains){return new RegExp("("+domains.join("|").replace(/\./g,"\\.")+")$")}function toClassName(state){return state.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function getRequestsFromHar(harData){function urlAbbreviate(url){return url=url.replace(/^https?:\/\/(www\.)?/i,""),url=url.replace(/\?.*/g,""),url=url.replace(/#.*/g,"")}function mimeToFiletype(mimeType){return mimeType.indexOf("image")>-1?"image":mimeType.indexOf("script")>-1?"script":mimeType.indexOf("css")>-1?"style":mimeType.indexOf("font")>-1?"font":"other"}function getFileTags(entry){function getMatchFunction(regex){return function(entry){return Boolean(entry.url.match(regex))}}var tags={};return Object.keys(config.fileTags).forEach(function(tagName){var filter=config.fileTags[tagName];"function"!=typeof filter&&(filter=getMatchFunction(filter)),tags[tagName]=Boolean(filter(entry))}),tags}function getProviders(entry){var providers={};return Object.keys(config.providers).forEach(function(providerName){var providerRegex=arrayToDomainRegex(config.providers[providerName]);entry.domain.match(providerRegex)&&(providers[providerName]=!0)}),providers}var harLog=harData.log,startDate=new Date(harLog.pages[0].startedDateTime),onLoad=harLog.pages[0].pageTimings.onLoad,items=[];return harLog.pages.length>1&&(harLog.entries=harLog.entries.filter(function(entry){return entry.pageref===harLog.pages[0].id})),items=harLog.entries.map(function(entry){var startTimeMs=new Date(entry.startedDateTime)-startDate,url=urlAbbreviate(entry.request.url);return{type:mimeToFiletype(entry.response.content.mimeType||""),originalUrl:entry.request.url,url:url,domain:url.substring(0,url.indexOf("/")),path:url.substring(url.indexOf("/")),start:startTimeMs,duration:entry.time,end:Math.round(startTimeMs+entry.time)}}),items.forEach(function(item){item.tags=getFileTags(item),item.providers=getProviders(item)}),items=items.filter(function(item){return item.start<=onLoad})}function D3HarChart(){EventEmitter.call(this)}var amazonDomainsRegex,firstPartyRegex,config,chartContainer,googleAdDomainsRegex,EventEmitter=require("events").EventEmitter,inherits=require("inherits");firstPartyRegex=arrayToDomainRegex(["gawker.com","kinja.com","kinja-img.com","kinja-static.com"]),googleAdDomainsRegex=arrayToDomainRegex(["googletagservices.com","googleadservices.com","googlesyndication.com","doubleclick.net"]),amazonDomainsRegex=arrayToDomainRegex(["amazon-adsystem.com"]),config={providers:{adobeAudienceManager:["demdex.net"],amazon:["amazon-adsystem.com"],chartbeat:["chartbeat.com","chartbeat.net"],comscore:["scorecardresearch.com"],criteo:["criteo.com"],ghostery:["betrad.com"],google:["googletagservices.com","googleadservices.com","googlesyndication.com","doubleclick.net","2mdn.net"],googleAnalytics:["google-analytics.com"],integral:["adsafeprotected.com","iasds01.com"],krux:["krxd.net","krux.com"],moat:["moatads.com"],nielsen:["imrworldwide.com"],quantcast:["quantserve.com"],researchNow:["researchnow.com"],skimlinks:["skimresources.com"]},providerGroups:{ads:["adobeAudienceManager","amazon","ghostery","google","integral","moat","researchNow","skimlinks"],analytics:["cheartbeat","comscore","googleAnalytics","quantcast","nielsen"]},fileTags:{scriptLoader:/require\.js/i,mainScript:/javascripts\-min\/layer\/.*\.js$/i,firstParty:function(item){return Boolean(item.domain.match(firstPartyRegex))},stats:function(item){return item.domain.match(firstPartyRegex)&&0===item.path.indexOf("/stats/")},vendorGoogleAds:function(item){return item.domain.match(googleAdDomainsRegex)},vendorAmazon:function(item){return item.domain.match(amazonDomainsRegex)}},itemHeight:10,itemMargin:2},chartContainer=window.document.querySelector(".chart"),inherits(D3HarChart,EventEmitter),D3HarChart.prototype.displayObject=function(harObject){function getProvidersDisplayName(providers){return Object.keys(providers).filter(function(providerName){return Boolean(providers[providerName])}).map(function(providerName){return providerName=providerName.replace(/([a-z])([A-Z])/g,"$1 $2"),providerName.charAt(0).toUpperCase()+providerName.slice(1)}).join(" / ")}function msToRoundedS(ms){var seconds=ms/1e3;return Math.round(100*seconds)/100+"s"}var data,last,totalHeight,svg,bars,tooltip;data=getRequestsFromHar(data),last=data[data.length-1],totalHeight=(config.itemHeight+config.itemMargin)*data.length,svg=d3.select(".chart").append("svg").attr("viewBox","0 0 "+last.end+" "+totalHeight).attr("preserveAspectRatio","none"),tooltip=d3.select(".chart").append("div").style("opacity",0).attr("class","tooltip"),bars=svg.selectAll("rect").data(data).enter().append("rect").attr("id",function(d,i){return"chartEntry"+i}).attr("x",function(d){return d.start}).attr("y",function(d,i){return i*(config.itemHeight+config.itemMargin)}).attr("width",function(d){return d.duration}).attr("height",function(d){return config.itemHeight}).attr("title",function(d){return d.domain+d.path}).each(function(d){this.classList.add("filetype-"+d.type),Object.keys(d.tags).forEach(function(tagName){d.tags[tagName]&&this.classList.add("tag-"+toClassName(tagName))}.bind(this)),Object.keys(d.providers).forEach(function(providerName){d.providers[providerName]&&this.classList.add("provider-"+providerName)}.bind(this))}).on("mouseover",function(d){window.postMessage(JSON.stringify({namespace:"reveal-chart",eventName:"showTooltip",itemData:d,selection:this,id:this.id}),"*")}).on("mouseout",function(d){window.postMessage(JSON.stringify({namespace:"reveal-chart",eventName:"hideTooltip",itemData:d,id:this.id}),"*")}),window.addEventListener("message",function(event){var itemData,itemEl,provider,data=JSON.parse(event.data);window.parent&&window.parent!==window&&window.parent.postMessage(event.data,"*"),data&&"reveal-chart"===data.namespace&&(itemData=data.itemData,itemEl=window.document.getElementById(data.id),"showTooltip"===data.eventName?(provider=getProvidersDisplayName(itemData.providers),itemEl.classList.add("selected"),tooltip.html("<p>"+itemData.url+"</p>"+(provider?"<p>Provider: "+provider+"</p>":"")+"<p>Start: "+msToRoundedS(itemData.start)+" / End: "+msToRoundedS(itemData.end)+" ("+msToRoundedS(itemData.duration)+")</p>").style("opacity",1),this.emit("tooltipOpened")):"hideTooltip"===data.eventName&&(itemEl.classList.remove("selected"),tooltip.html("").style("opacity",0),this.emit("tooltipClosed")))}.bind(this))},D3HarChart.prototype.displayFile=function(harPath){d3.json(harPath,function(error,data){data&&this.displayObject(data)}.bind(this))},module.exports=D3HarChart},{events:2,inherits:3}],2:[function(require,module,exports){function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(arg){return"function"==typeof arg}function isNumber(arg){return"number"==typeof arg}function isObject(arg){return"object"==typeof arg&&null!==arg}function isUndefined(arg){return void 0===arg}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||0>n||isNaN(n))throw TypeError("n must be a positive number");return this._maxListeners=n,this},EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(this._events||(this._events={}),"error"===type&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if(er=arguments[1],er instanceof Error)throw er;throw TypeError('Uncaught, unspecified "error" event.')}if(handler=this._events[type],isUndefined(handler))return!1;if(isFunction(handler))switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:args=Array.prototype.slice.call(arguments,1),handler.apply(this,args)}else if(isObject(handler))for(args=Array.prototype.slice.call(arguments,1),listeners=handler.slice(),len=listeners.length,i=0;len>i;i++)listeners[i].apply(this,args);return!0},EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener),this._events[type]?isObject(this._events[type])?this._events[type].push(listener):this._events[type]=[this._events[type],listener]:this._events[type]=listener,isObject(this._events[type])&&!this._events[type].warned&&(m=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners,m&&m>0&&this._events[type].length>m&&(this._events[type].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[type].length),"function"==typeof console.trace&&console.trace())),this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(type,listener){function g(){this.removeListener(type,g),fired||(fired=!0,listener.apply(this,arguments))}if(!isFunction(listener))throw TypeError("listener must be a function");var fired=!1;return g.listener=listener,this.on(type,g),this},EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;if(list=this._events[type],length=list.length,position=-1,list===listener||isFunction(list.listener)&&list.listener===listener)delete this._events[type],this._events.removeListener&&this.emit("removeListener",type,listener);else if(isObject(list)){for(i=length;i-- >0;)if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}if(0>position)return this;1===list.length?(list.length=0,delete this._events[type]):list.splice(position,1),this._events.removeListener&&this.emit("removeListener",type,listener)}return this},EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[type]&&delete this._events[type],this;if(0===arguments.length){for(key in this._events)"removeListener"!==key&&this.removeAllListeners(key);return this.removeAllListeners("removeListener"),this._events={},this}if(listeners=this._events[type],isFunction(listeners))this.removeListener(type,listeners);else if(listeners)for(;listeners.length;)this.removeListener(type,listeners[listeners.length-1]);return delete this._events[type],this},EventEmitter.prototype.listeners=function(type){var ret;return ret=this._events&&this._events[type]?isFunction(this._events[type])?[this._events[type]]:this._events[type].slice():[]},EventEmitter.prototype.listenerCount=function(type){if(this._events){var evlistener=this._events[type];if(isFunction(evlistener))return 1;if(evlistener)return evlistener.length}return 0},EventEmitter.listenerCount=function(emitter,type){return emitter.listenerCount(type)}},{}],3:[function(require,module,exports){"function"==typeof Object.create?module.exports=function(ctor,superCtor){ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}})}:module.exports=function(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype,ctor.prototype=new TempCtor,ctor.prototype.constructor=ctor}},{}]},{},[1])(1)});
